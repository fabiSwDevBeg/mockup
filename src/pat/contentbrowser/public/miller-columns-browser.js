!function(){"use strict";function t(){}const e=t=>t;function n(t){return t()}function o(){return Object.create(null)}function r(t){t.forEach(n)}function l(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}const c="undefined"!=typeof window;let a=c?()=>window.performance.now():()=>Date.now(),u=c?t=>requestAnimationFrame(t):t;const d=new Set;function h(t){d.forEach((e=>{e.c(t)||(d.delete(e),e.f())})),0!==d.size&&u(h)}function f(t,e){t.appendChild(e)}function p(t,e,n){t.insertBefore(e,n||null)}function g(t){t.parentNode.removeChild(t)}function m(t){return document.createElement(t)}function b(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function y(t){return document.createTextNode(t)}function $(){return y(" ")}function _(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function v(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t){const e={};for(const n of t)e[n.name]=n.value;return e}const k=new Set;let C,E=0;function I(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),r=n.length-o.length;r&&(t.style.animation=o.join(", "),E-=r,E||u((()=>{E||(k.forEach((t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}})),k.clear())})))}function j(t){C=t}function M(){if(!C)throw new Error("Function called outside component initialization");return C}const T=[],A=[],L=[],P=[],S=Promise.resolve();let O=!1;function R(t){L.push(t)}let z=!1;const q=new Set;function N(){if(!z){z=!0;do{for(let t=0;t<T.length;t+=1){const e=T[t];j(e),B(e.$$)}for(j(null),T.length=0;A.length;)A.pop()();for(let t=0;t<L.length;t+=1){const e=L[t];q.has(e)||(q.add(e),e())}L.length=0}while(T.length);for(;P.length;)P.pop()();O=!1,z=!1,q.clear()}}function B(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(R)}}let H;function V(t,e,n){t.dispatchEvent(function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(`${e?"intro":"outro"}${n}`))}const D=new Set;let U;function F(t,e){t&&t.i&&(D.delete(t),t.i(e))}const J={duration:0};function G(n,o,r){let s,i,c=o(n,r),f=!1,p=0;function g(){s&&I(n,s)}function b(){const{delay:o=0,duration:r=300,easing:l=e,tick:b=t,css:y}=c||J;y&&(s=function(t,e,n,o,r,l,s,i=0){const c=16.666/o;let a="{\n";for(let t=0;t<=1;t+=c){const o=e+(n-e)*l(t);a+=100*t+`%{${s(o,1-o)}}\n`}const u=a+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${i}`,h=t.ownerDocument;k.add(h);const f=h.__svelte_stylesheet||(h.__svelte_stylesheet=h.head.appendChild(m("style")).sheet),p=h.__svelte_rules||(h.__svelte_rules={});p[d]||(p[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${d} ${o}ms linear ${r}ms 1 both`,E+=1,d}(n,0,1,r,o,l,y,p++)),b(0,1);const $=a()+o,_=$+r;i&&i.abort(),f=!0,R((()=>V(n,!0,"start"))),i=function(t){let e;return 0===d.size&&u(h),{promise:new Promise((n=>{d.add(e={c:t,f:n})})),abort(){d.delete(e)}}}((t=>{if(f){if(t>=_)return b(1,0),V(n,!0,"end"),g(),f=!1;if(t>=$){const e=l((t-$)/r);b(e,1-e)}}return f}))}let y=!1;return{start(){y||(I(n),l(c)?(c=c(),(H||(H=Promise.resolve(),H.then((()=>{H=null}))),H).then(b)):b())},invalidate(){y=!1},end(){f&&(g(),f=!1)}}}function W(t,e){const n=e.token={};function o(t,o,l,s){if(e.token!==n)return;e.resolved=s;let i=e.ctx;void 0!==l&&(i=i.slice(),i[l]=s);const c=t&&(e.current=t)(i);let a=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==o&&t&&(U={r:0,c:[],p:U},function(t,e,n,o){if(t&&t.o){if(D.has(t))return;D.add(t),U.c.push((()=>{D.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),U.r||r(U.c),U=U.p)})):e.block.d(1),c.c(),F(c,1),c.m(e.mount(),e.anchor),a=!0),e.block=c,e.blocks&&(e.blocks[o]=c),a&&N()}if((l=t)&&"object"==typeof l&&"function"==typeof l.then){const n=M();if(t.then((t=>{j(n),o(e.then,1,e.value,t),j(null)}),(t=>{if(j(n),o(e.catch,2,e.error,t),j(null),!e.hasCatch)throw t})),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}var l}function K(t,e){t.d(1),e.delete(t.key)}function Q(t,e){-1===t.$$.dirty[0]&&(T.push(t),O||(O=!0,S.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(e,s,i,c,a,u,d=[-1]){const h=C;j(e);const f=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:o(),dirty:d,skip_bound:!1};let p=!1;if(f.ctx=i?i(e,s.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&a(f.ctx[t],f.ctx[t]=r)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](r),p&&Q(e,t)),n})):[],f.update(),p=!0,r(f.before_update),f.fragment=!!c&&c(f.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);f.fragment&&f.fragment.l(t),t.forEach(g)}else f.fragment&&f.fragment.c();s.intro&&F(e.$$.fragment),function(t,e,o,s){const{fragment:i,on_mount:c,on_destroy:a,after_update:u}=t.$$;i&&i.m(e,o),s||R((()=>{const e=c.map(n).filter(l);a?a.push(...e):r(e),t.$$.on_mount=[]})),u.forEach(R)}(e,s.target,s.anchor,s.customElement),N()}j(h)}let Y;"function"==typeof HTMLElement&&(Y=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(n).filter(l);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});const Z=[];function tt(e,n=t){let o;const r=[];function l(t){if(s(e,t)&&(e=t,o)){const t=!Z.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),Z.push(n,e)}if(t){for(let t=0;t<Z.length;t+=2)Z[t][0](Z[t+1]);Z.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(s,i=t){const c=[s,i];return r.push(c),1===r.length&&(o=n(l)||t),s(e),()=>{const t=r.indexOf(c);-1!==t&&r.splice(t,1),0===r.length&&(o(),o=null)}}}}const et=tt("/");function nt(t){const e=t-1;return e*e*e+1}function ot(t,{delay:e=0,duration:n=400,easing:o=nt,x:r=0,y:l=0,opacity:s=0}={}){const i=getComputedStyle(t),c=+i.opacity,a="none"===i.transform?"":i.transform,u=c*(1-s);return{delay:e,duration:n,easing:o,css:(t,e)=>`\n\t\t\ttransform: ${a} translate(${(1-t)*r}px, ${(1-t)*l}px);\n\t\t\topacity: ${c-u*e}`}}function rt(t,e,n){const o=t.slice();return o[10]=e[n],o[12]=n,o}function lt(t,e,n){const o=t.slice();return o[13]=e[n],o[15]=n,o}function st(t){let e,n,o=t[16].message+"";return{c(){var t,r,l;e=m("p"),n=y(o),t="color",r="red",e.style.setProperty(t,r,l?"important":"")},m(t,o){p(t,e,o),f(e,n)},p(t,e){2&e&&o!==(o=t[16].message+"")&&w(n,o)},d(t){t&&g(e)}}}function it(t){let e,n,o,r=[],l=new Map,s=t[9];const i=t=>t[10].path;for(let e=0;e<s.length;e+=1){let n=rt(t,s,e),o=i(n);l.set(o,r[e]=dt(o,n))}return{c(){e=m("div");for(let t=0;t<r.length;t+=1)r[t].c();n=$(),o=m("div"),v(o,"class","preview"),v(e,"class","levelColumns")},m(t,l){p(t,e,l);for(let t=0;t<r.length;t+=1)r[t].m(e,null);f(e,n),f(e,o)},p(t,o){10&o&&(s=t[9],r=function(t,e,n,o,r,l,s,i,c,a,u,d){let h=t.length,f=l.length,p=h;const g={};for(;p--;)g[t[p].key]=p;const m=[],b=new Map,y=new Map;for(p=f;p--;){const t=d(r,l,p),i=n(t);let c=s.get(i);c?o&&c.p(t,e):(c=a(i,t),c.c()),b.set(i,m[p]=c),i in g&&y.set(i,Math.abs(p-g[i]))}const $=new Set,_=new Set;function v(t){F(t,1),t.m(i,u),s.set(t.key,t),u=t.first,f--}for(;h&&f;){const e=m[f-1],n=t[h-1],o=e.key,r=n.key;e===n?(u=e.first,h--,f--):b.has(r)?!s.has(o)||$.has(o)?v(e):_.has(r)?h--:y.get(o)>y.get(r)?(_.add(o),v(e)):($.add(r),h--):(c(n,s),h--)}for(;h--;){const e=t[h];b.has(e.key)||c(e,s)}for(;f;)v(m[f-1]);return m}(r,o,i,1,t,s,l,e,K,dt,n,rt))},d(t){t&&g(e);for(let t=0;t<r.length;t+=1)r[t].d()}}}function ct(t){let e,n,o;return{c(){e=m("img"),e.src!==(n=t[13].getURL+"/@@images/image/tile")&&v(e,"src",n),v(e,"alt",o=t[13].Title)},m(t,n){p(t,e,n)},p(t,r){2&r&&e.src!==(n=t[13].getURL+"/@@images/image/tile")&&v(e,"src",n),2&r&&o!==(o=t[13].Title)&&v(e,"alt",o)},d(t){t&&g(e)}}}function at(t){let e,n,o,r;function l(){return t[8](t[13])}return{c(){e=b("svg"),n=b("path"),v(n,"d","M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"),v(e,"xmlns","http://www.w3.org/2000/svg"),v(e,"width","16"),v(e,"height","16"),v(e,"fill","currentColor"),v(e,"class","bi bi-arrow-right-circle-fill"),v(e,"viewBox","0 0 16 16")},m(t,s){p(t,e,s),f(e,n),o||(r=_(e,"click",l),o=!0)},p(e,n){t=e},d(t){t&&g(e),o=!1,r()}}}function ut(t){let e,n,o,r,l,s,i=t[13].Title+"",c="Image"===t[13].portal_type&&ct(t),a=t[13].is_folderish&&at(t);return{c(){e=m("div"),n=m("div"),o=y(i),l=$(),c&&c.c(),s=$(),a&&a.c(),v(n,"title",r=t[13].portal_type),v(e,"class","relatedItem"+(t[15]%2==0?" odd":" even"))},m(t,r){p(t,e,r),f(e,n),f(n,o),f(e,l),c&&c.m(e,null),f(e,s),a&&a.m(e,null)},p(t,l){2&l&&i!==(i=t[13].Title+"")&&w(o,i),2&l&&r!==(r=t[13].portal_type)&&v(n,"title",r),"Image"===t[13].portal_type?c?c.p(t,l):(c=ct(t),c.c(),c.m(e,s)):c&&(c.d(1),c=null),t[13].is_folderish?a?a.p(t,l):(a=at(t),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(t){t&&g(e),c&&c.d(),a&&a.d()}}}function dt(e,n){let o,r,l,s,i,c,a=n[10].path+"",u=n[10].results,d=[];for(let t=0;t<u.length;t+=1)d[t]=ut(lt(n,u,t));return{key:e,first:null,c(){o=m("div"),r=m("div"),l=y(a),s=$();for(let t=0;t<d.length;t+=1)d[t].c();v(r,"class","levelPath"),v(o,"class",i="levelColumn"+(n[12]%2==0?" odd":" even")),this.first=o},m(t,e){p(t,o,e),f(o,r),f(r,l),f(o,s);for(let t=0;t<d.length;t+=1)d[t].m(o,null)},p(t,e){if(n=t,2&e&&a!==(a=n[10].path+"")&&w(l,a),10&e){let t;for(u=n[10].results,t=0;t<u.length;t+=1){const r=lt(n,u,t);d[t]?d[t].p(r,e):(d[t]=ut(r),d[t].c(),d[t].m(o,null))}for(;t<d.length;t+=1)d[t].d(1);d.length=u.length}2&e&&i!==(i="levelColumn"+(n[12]%2==0?" odd":" even"))&&v(o,"class",i)},i(t){t&&(c||R((()=>{c=G(o,ot,{duration:1e3}),c.start()})))},o:t,d(t){t&&g(o),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(d,t)}}}function ht(e){let n;return{c(){n=m("p"),n.textContent="...waiting"},m(t,e){p(t,n,e)},p:t,d(t){t&&g(n)}}}function ft(e){let n,o,r,l,s,i,c,a,u,d,h,x,k,C,E={ctx:e,current:null,token:null,hasCatch:!0,pending:ht,then:it,catch:st,value:9,error:16};return W(x=e[1],E),{c(){n=m("h2"),n.textContent="Related Items Prototype",o=$(),r=m("div"),l=b("svg"),s=b("path"),i=b("path"),c=$(),a=m("span"),u=y(e[0]),d=$(),h=y(""),E.block.c(),this.c=t,v(s,"fill-rule","evenodd"),v(s,"d","M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"),v(i,"fill-rule","evenodd"),v(i,"d","M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"),v(l,"class","homeAction bi bi-house"),v(l,"xmlns","http://www.w3.org/2000/svg"),v(l,"width","16"),v(l,"height","16"),v(l,"fill","currentColor"),v(l,"viewBox","0 0 16 16"),v(a,"class","path"),v(r,"class","toolBar")},m(t,g){p(t,n,g),p(t,o,g),p(t,r,g),f(r,l),f(l,s),f(l,i),f(r,c),f(r,a),f(a,u),p(t,d,g),p(t,h,g),E.block.m(t,E.anchor=g),E.mount=()=>h.parentNode,E.anchor=h,k||(C=_(l,"click",e[7]),k=!0)},p(t,[n]){if(e=t,1&n&&w(u,e[0]),E.ctx=e,2&n&&x!==(x=e[1])&&W(x,E));else{const t=e.slice();t[9]=t[16]=E.resolved,E.block.p(t,n)}},i:t,o:t,d(t){t&&g(n),t&&g(o),t&&g(r),t&&g(d),t&&g(h),E.block.d(t),E.token=null,E=null,k=!1,C()}}}function pt(t,e,n){let o,r;i(t,et,(t=>n(0,o=t)));let{max_depth:l=2}=e,{attr_string:s="UID, Title, portal_type, path, getURL, getIcon, is_folderish, review_state"}=e,{vocabulary_url:c="http://localhost:8081/Plone/@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems&query="}=e;const a=function(t,e){const n=tt([]);return e=e||"http://localhost:8081/Plone/@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems&query=",n.request=async(o,r,l=null)=>{let s=`{"criteria":[{"i":"path","o":"plone.app.querystring.operation.string.path","v":"${r}::1"}],"sort_on":"getObjPositionInParent","sort_order":"ascending"}`,i=t.split(",").map((t=>t.trim())),c="&attributes="+JSON.stringify(i),a=e+s+c;n.update((t=>(delete t.errors,t.loading=!0,t)));let u=new Headers;u.set("Content-type","application/json");const d=l?JSON.stringify(l):void 0,h=await fetch(a,{method:o,body:d,headers:u}),f=await h.json();if(h.ok)return f;n.update((t=>(t.loading=!1,t.errors=f.errors,t)))},n.get=async(t,e)=>{e=e||3,console.log("maxDepth: ",e),console.log("path: ",t);let o=t.split("/");console.log("parts: ",o);const r=o.length>=e?e:o.length;let l=[],s=o.slice(o.length-r,o.length),i=o.slice(0,o.length-r);const c=i.join("/");for(console.log("sliced parts: ",s);s.length>0;){let t=s.join("/");t.startsWith("/")||(t="/"+t),t=c+t,console.log("sub_path: ",t),""===s.pop()&&(t="/"),-1===l.indexOf(t)&&l.push(t)}console.log("final paths: ",l),console.log("partsToHide: ",i);let a=[];for(var u of l){let t=await n.request("GET",u);t.path=u,a=[t,...a],console.log("p: ",u)}n.set(a),console.log(a)},n}(s,c);var u;function d(t){console.log("change path to: ",t),et.set(t)}i(t,a,(t=>n(1,r=t))),a.get(o),u=async()=>{console.log("mounted...")},M().$$.on_mount.push(u);return t.$$set=t=>{"max_depth"in t&&n(4,l=t.max_depth),"attr_string"in t&&n(5,s=t.attr_string),"vocabulary_url"in t&&n(6,c=t.vocabulary_url)},t.$$.update=()=>{17&t.$$.dirty&&(console.log(o),a.get(o,l))},[o,r,a,d,l,s,c,()=>d("/"),t=>d(t.path)]}customElements.define("miller-columns-browser",class extends Y{constructor(t){super(),this.shadowRoot.innerHTML="<style>.toolBar{background-color:lightskyblue;padding:0.5rem 1rem;color:#333;font-size:1.8rem}.toolBar>.path{padding:0 1.5rem;line-height:1em}.homeAction{width:1em;height:1em;vertical-align:-0.125em}.levelColumns{display:flex}.levelColumn{min-width:200px;border-top:5px solid transparent}.levelColumn.even{border-top:5px solid skyblue}.levelPath{background:#eee;padding:0.5rem 1rem}.relatedItem{display:flex;align-items:baseline;justify-content:space-between;border-right:1px solid #ddd}.relatedItem.even{background-color:aliceblue}.relatedItem>*{padding:1rem}.relatedItem>svg,.relatedItem>img{padding:0 1rem;margin:auto 0}.relatedItem>img{object-fit:cover;width:32px;height:32px}.preview{border:1px solid lightskyblue;min-width:200px;min-height:400px}</style>",X(this,{target:this.shadowRoot,props:x(this.attributes),customElement:!0},pt,ft,s,{max_depth:4,attr_string:5,vocabulary_url:6}),t&&(t.target&&p(t.target,this,t.anchor),t.props&&(this.$set(t.props),N()))}static get observedAttributes(){return["max_depth","attr_string","vocabulary_url"]}get max_depth(){return this.$$.ctx[4]}set max_depth(t){this.$set({max_depth:t}),N()}get attr_string(){return this.$$.ctx[5]}set attr_string(t){this.$set({attr_string:t}),N()}get vocabulary_url(){return this.$$.ctx[6]}set vocabulary_url(t){this.$set({vocabulary_url:t}),N()}})}();
//# sourceMappingURL=miller-columns-browser.js.map
